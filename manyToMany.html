<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Creating Many to Many Relationships in Laravel</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="prism.css" rel="stylesheet">
    <script src="prism.js"></script>
</head>
<body>
    <div class="container">
        <h1>Many to Many Relationship</h1>
        

        <h2>Thanks</h2>
        <p>
            Many thanks to Jeffrey Way at Laracasts for making Laravel so easy to learn.
        </p>
        

        <h2>Create the object tables</h2>
        <pre>
        <code>php artisan make:migration create_trips_table --create="trips"</code></pre>
        <pre>
        <code>php artisan make:migration create_locations_table --create="locations"</code></pre>
        <p>
            Naming conventions: I use the plural of the object (trips or locations) to name the table and migration. As the table stores trips and locations this makes
            sense from a readability perspective.
        </p>
        

        <h2>Create the many to many table</h2>
        <pre>
        <code>php artisan make:migration create_location_trip_table --create="location_trip"</code></pre>
        <p>
            Naming conventions: Take the singular of the objects (trips or locations) and order them alpabetically
        </p>
        
        

        <h2>
            Create the models for the trip and locations
        </h2>
        <p>
            Naming convention: Use the singular of the object because when instatiating it will represent one object
        </p>
        <pre>
        <code>php artisan make:model Trip</code></pre>
        <pre>
        <code>php artisan make:model Location</code></pre>


        <h2>
            Create the many to many relationship        
        </h2>
        <p>
            Naming convention: use the plural of the object or essentially the name of the table you are getting the linked
            objects from.
        </p>
        <p>
            Inside trips place this code
        </p>
        <p>
            Trip.php
        </p>
        <pre>
        <code>
            use App\Location;

            // ...

            public function locations()
            {
                return $this->belongsToMany(Location::class)->withTimestamps();
            }
        </code></pre>
        <p>
            Inside locations place this code
        </p>
        <p>
            Location.php
        </p>
        <pre>
        <code>
            use App\Trip;
        
            // ...

            public function trips()
            {
                return $this->belongsToMany(Trip::class)->withTimestamps();
            }
        </code></pre>

        <h2>
            How to relate the two together when you have the objects created?
        </h2>
        <p>
            php artisan tinker
        </p>
        <pre>
        <code>
            $trip = Trip::first();
            $location = Location::first();

            $location->trips()->attach($trip->id);
        </code></pre>

        <h2>
            In order to make the above factory work.
        </h2>
        <p>
            Go to the ModelFactory.php file and add a factory for the model
        </p>
        <p>
            ModelFactory.php
        </p>
        <pre>
        <code>
            $factory->define(App\Trip::class, function (Faker\Generator $faker) {
                return [
                    'title' => $faker->title,
                    'description' => $faker->paragraph,
                    'startdate' => $faker->dateTimeBetween($startDate = '-90 days', $endDate = '-30 days')->format('Y-m-d'),
                    'enddate' => $faker->dateTimeBetween($startDate = '-30 days', $endDate = 'now')->format('Y-m-d'),
                ];
            });

            $factory->define(App\Location::class, function (Faker\Generator $faker) {
                return [
                    'line1' => $faker->streetAddress,
                    'line2' => '',
                    'city' => $faker->city,
                    'state' => $faker->state,
                    'zip' => $faker->postcode,
                    'country' => $faker->country
                ];
            });
        </code>
        </pre>


    </div>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</body>
</html>